var t=Object.defineProperty,e=(e,i,s)=>(((e,i,s)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(e,"symbol"!=typeof i?i+"":i,s),s);let i,s,h=()=>{},r={};function n(t,...e){(r[t]||[]).map((t=>t(...e)))}let a={get:(t,e)=>"_proxy"==e||h};function o(){return i}function c(){return s}class d{constructor({spriteSheet:t,frames:e,frameRate:i,loop:s=!0}){this.spriteSheet=t,this.frames=e,this.frameRate=i,this.loop=s;let{width:h,height:r,margin:n=0}=t.frame;this.width=h,this.height=r,this.margin=n,this._f=0,this._a=0}clone(){return new d(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:e,width:i=this.width,height:s=this.height,context:h=c()}){let r=this.frames[this._f]/this.spriteSheet._f|0,n=this.frames[this._f]%this.spriteSheet._f|0;h.drawImage(this.spriteSheet.image,n*this.width+(2*n+1)*this.margin,r*this.height+(2*r+1)*this.margin,this.width,this.height,t,e,i,s)}}function l(){return new d(...arguments)}function u(t,e){return(Math.random()*(e-t+1)|0)+t}function p(t,e,i){return Math.min(Math.max(t,i),e)}class m{constructor(t=0,e=0,i={}){this.x=t,this.y=e,i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}add(t){return new m(this.x+t.x,this.y+t.y,this)}subtract(t){return new m(this.x-t.x,this.y-t.y,this)}scale(t){return new m(this.x*t,this.y*t)}normalize(t=this.length()){return new m(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?p(this._a,this._d,t):t}set y(t){this._y=this._c?p(this._b,this._e,t):t}}function w(){return new m(...arguments)}class _ extends class{constructor(t){return this.init(t)}init(t={}){this.position=w(),this.velocity=w(),this.acceleration=w(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}{init({width:t=0,height:e=0,context:i=c(),render:s=this.draw,update:h=this.advance,children:r=[],anchor:n={x:0,y:0},opacity:a=1,rotation:o=0,scaleX:d=1,scaleY:l=1,...u}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:n,opacity:a,rotation:o,scaleX:d,scaleY:l,...u}),this._di=!0,this._uw(),this.addChild(r),this._rf=s,this._uf=h}update(t){this._uf(t),this.children.map((e=>e.update&&e.update(t)))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let e=-this.width*this.anchor.x,i=-this.height*this.anchor.y;(e||i)&&t.translate(e,i),this.context.globalAlpha=this.opacity,this._rf(),(e||i)&&t.translate(-e,-i),this.children.map((t=>t.render&&t.render())),t.restore()}draw(){}_pc(){this._uw(),this.children.map((t=>t._pc()))}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wr:s=0,_wsx:h=1,_wsy:r=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=i*this.opacity,this._wsx=h*this.scaleX,this._wsy=r*this.scaleY,this._wx=this._wx*h,this._wy=this._wy*r,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=s+this.rotation;let{x:n,y:a}=((t,e)=>{let i=Math.sin(e),s=Math.cos(e);return{x:t.x*s-t.y*i,y:t.x*i+t.y*s}})({x:this._wx,y:this._wy},s);this._wx=n,this._wy=a,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map((t=>{this.children.push(t),t.parent=this,t._pc=t._pc||h,t._pc()}))}removeChild(...t){t.flat().map((t=>{((t,e)=>{let i=t.indexOf(e);if(-1!=i)return t.splice(i,1),!0})(this.children,t)&&(t.parent=null,t._pc())}))}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class f extends _{init({image:t,width:e=(t?t.width:void 0),height:i=(t?t.height:void 0),...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function x(){return new f(...arguments)}let y=/(\d+)(\w+)/;class A extends _{init({text:t="",textAlign:e="",lineHeight:i=1,font:s=c().font,...h}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:i,font:s,...h}),this._p()}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=(t=>{let e=t.match(y),i=+e[1];return{size:i,unit:e[2],computed:i}})(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context;if(t.font=this.font,!this._s.length&&this._fw){let e=this.text.split(" "),i=0,s=2;for(;s<=e.length;s++){let h=e.slice(i,s).join(" ");t.measureText(h).width>this._fw&&(this._s.push(e.slice(i,s-1).join(" ")),i=s-1)}this._s.push(e.slice(i,s).join(" "))}if(!this._s.length&&this.text.includes("\n")){let e=0;this.text.split("\n").map((i=>{this._s.push(i),e=Math.max(e,t.measureText(i).width)})),this._w=this._fw||e}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,i=this.context;e=this.textAlign||("rtl"==i.canvas.dir?"right":"left"),t="right"==e?this.width:"center"==e?this.width/2|0:0,this._s.map(((s,h)=>{i.textBaseline="top",i.textAlign=e,i.fillStyle=this.color,i.font=this.font,i.fillText(s,t,this._fs*this.lineHeight*h)}))}}function g(){return new A(...arguments)}function I(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}let R,S={},H={},v={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"},T={swipe:{touches:1,threshold:10,touchend({0:t}){let e=t.x-t.start.x,i=t.y-t.start.y,s=Math.abs(e),h=Math.abs(i);if(s>=this.threshold||h>=this.threshold)return s>h?0>e?"left":"right":0>i?"up":"down"}},pinch:{touches:2,threshold:2,touchstart({0:t,1:e}){this.prevDist=Math.hypot(t.x-e.x,t.y-e.y)},touchmove({0:t,1:e}){let i=Math.hypot(t.x-e.x,t.y-e.y);if(Math.abs(i-this.prevDist)<this.threshold)return;let s=i>this.prevDist?"out":"in";return this.prevDist=i,s}}},E={},C={},Q={},J={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function M(t=h,e){t._pd&&e.preventDefault(),t(e)}function N(t){let e=J[t.code],i=E[e];Q[e]=!0,M(i,t)}function Y(t){let e=J[t.code],i=C[e];Q[e]=!1,M(i,t)}function b(){Q={}}function K(t,e){return Object.values(e).includes(t)}function L(t){return Object.keys(T).some((e=>t.startsWith(e)))}function P(t){if(+t==t)return t;let e=[],i=t.split(".."),s=+i[0],h=+i[1],r=s;if(h>s)for(;h>=r;r++)e.push(r);else for(;r>=h;r--)e.push(r);return e}class O{constructor({image:t,frameWidth:e,frameHeight:i,frameMargin:s,animations:h}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:e,height:i,margin:s},this._f=t.width/e|0,this.createAnimations(h)}createAnimations(t){let e,i;for(i in t){let{frames:s,frameRate:h,loop:r}=t[i];if(e=[],null==s)throw Error("Animation "+i+" must provide a frames property");[].concat(s).map((t=>{e=e.concat(P(t))})),this.animations[i]=l({spriteSheet:this,frames:e,frameRate:h,loop:r})}}}function k(){return new O(...arguments)}class Z{constructor(t,...i){e(this,"currentState"),this.currentState=t,this.currentState.onEnter&&this.currentState.onEnter(...i)}setState(t,...e){this.currentState.onLeave&&this.currentState.onLeave(),this.currentState=t,this.currentState.onEnter&&this.currentState.onEnter(...e)}getState(){return this.currentState}}const D=t=>{let{t:e,b:i,_c:s,d:h}=t;return(s-i)*e/h+i},U="2a173b95c5ac4c5c8769809e443f7b3f2c5f",G="@@@IIIA@@@@@HQRRRI@@@@HR[[[SJ@@@HZ[[[[[J@@@a[[[[[cA@@HedddddM@@@qmmmmmuA@@H^[ts\\[N@@@q[Z^^ZsA@@H^k^[n[N@@HI^[[[[N@@HbM^[[[NMIAamKm[kM]eTAIiMIIIsNmL@@IqvvvIHI@@@@i[[kA@@@@@HvvvN@@@@@@iMInA@@@@@@INHnA@@@@@@HMHI@@@@@@@H@iA@@@@@@@@@A@@";function V(t,e,i,s,h){if(!t)return;let r=t,n=e,a=[];for(let d of i){let t=d.charCodeAt(0);a.push(7&t),a.push(t>>3&7)}let o=s,c=h;for(let d=0;c>d;d++)for(let t=0;o>t;t++)if(a[d*o+t]){let e=6*(a[d*o+t]-1),i=e+6,s={x:t-Math.floor(o/2),y:d-Math.floor(c/2)};r.fillStyle="#"+n.slice(e,i),r.fillRect(s.x,s.y,1,1)}}function X(t,e,i,s,h){if(!t)return;let r=t,n=e,a=[];for(let d of i){let t=d.charCodeAt(0);a.push(7&t),a.push(t>>3&7)}let o=s,c=h;for(let d=0;c>d;d++)for(let t=0;o>t;t++)if(a[d*o+t]){let e=6*(a[d*o+t]-1),i=e+6,s={x:t,y:d};r.fillStyle="#"+n.slice(e,i),r.fillRect(s.x,s.y,1,1)}}function W(t,e){if(!t.radius||!e.radius)return;let i=e.x-t.x,s=e.y-t.y,h=[t.radius*t.scaleX,e.radius*e.scaleX];return Math.hypot(i,s)<h[0]+h[1]}class q extends f{constructor(t){super({...t,anchor:{x:.5,y:.5},opacity:.75}),e(this,"direction",0),e(this,"type","coin"),e(this,"radius",8),e(this,"counter",0),e(this,"mov_speed",5),e(this,"sprite"),this.sprite=this.makeSpriteSheet()}set setDirection(t){this.direction=p(0,7,t)}get getDirection(){return this.direction}draw(){this.sprite.render()}drawCollisionCircle(t){let{context:e,radius:i}=this;e.fillStyle=t,e.beginPath(),e.arc(0,0,i,0,2*Math.PI),e.fill()}update(){this.travel(),this.sprite.update()}makeSpriteSheet(){let t=document.createElement("canvas"),e=t.getContext("2d");return t.width=128,t.height=16,X(e,"2a173b95c5ac69809e4c5c873f2c5f","@@HIIA@@@@HIIA@@@@@II@@@@@@II@@@@@@HA@@@@@@II@@@@@@II@@@@@HIIA@@@HQRRJA@@@QRRJA@@@HRRI@@@@HRRA@@@@@QJ@@@@@HRRA@@@@IRRA@@@HQRRJ@@@QZ[[SJ@@HZ[[SJ@@@Q[[RA@@@H[SA@@@@HSRA@@@@HZ[A@@@HR[[J@@@QZ[[SA@HZ[[[[SA@Q[[[[J@@H[[[SA@@@Y[SJ@@@@H[RA@@@@QZ[K@@@HZ[[[A@@Q[[[[J@HZ[[[[SA@Y[[[[SA@H[[[[J@@@Y[SJ@@@@H[RA@@@@QZ[K@@@Q[[[[A@HZ[[[[K@Q[[[[[[JH[[[[[SA@Y[[[[J@@@Y[SJ@@@@H[SA@@@@QZ[K@@@Q[[[[K@HZ[[[[[AY[[[[[[KH[[[[[SA@Y[[[[J@@@Y[[J@@@@H[SA@@@@Q[[K@@@Q[[[[K@HZ[[[[[AY[[[[[[KH[[[[[SA@Y[[[[J@@@Y[[J@@@@H[SA@@@@Q[[K@@@Q[[[[K@HZ[[[[[Aa[[[[[[KH[[[[[SA@Y[[[[J@@@Y[cJ@@@@H[[A@@@@Q\\[K@@@Q[[[[K@HZ[[[[[Aa\\[[[[[LH[[[[[SA@Y[[[cJ@@@Y[cJ@@@@H[cA@@@@Q\\[K@@@Q\\[[[K@HZ[[[[[Aa\\[[[[cLH[[[[[SA@Y[[[cJ@@@Y[dJ@@@@H[cA@@@@Qd[K@@@Q\\[[[K@HZ[[[[[AHd[[[[dA@Y[[[[dA@H[[[dK@@@Y[dJ@@@@H[dA@@@@Qd[K@@@Yd[[[A@Hd[[[[K@Hd\\[[ddA@Y[[[cL@@H[[cdA@@@YcdK@@@@HcdA@@@@Yd\\K@@@Hd\\[[A@@a\\[[[K@@addddL@@H\\[ddL@@@Y[ddA@@@HddA@@@@HddA@@@@HddA@@@Hdd[K@@@add[cA@@HaddLA@@@addLA@@@HddI@@@@HddA@@@@@aL@@@@@HddA@@@@IddA@@@HaddL@@@@HIIA@@@@HIIA@@@@@II@@@@@@II@@@@@@HA@@@@@@II@@@@@@II@@@@@HIIA@@",128,16),x({x:0,y:0,anchor:{x:.5,y:.5},animations:k({image:t,frameWidth:16,frameHeight:16,animations:{walk:{frames:"0..7",frameRate:20}}}).animations})}scaleUpdate(){let t=D({t:++this.counter,b:2,_c:3,d:35});this.setScale(t)}travel(){if(void 0===this.direction||"number"!=typeof this.direction)return;let t=45*this.direction/180*Math.PI;this.x+=this.mov_speed*Math.cos(t),this.y+=this.mov_speed*Math.sin(t),this.scaleUpdate()}}class j extends f{constructor(t){super({...t,anchor:{x:.5,y:.5},opacity:.75}),e(this,"direction",0),e(this,"type","enemy"),e(this,"radius",15),e(this,"counter",0),e(this,"mov_speed",4),e(this,"testSprite"),this.testSprite=this.makeSpriteSheet()}set setDirection(t){this.direction=p(0,7,t)}get getDirection(){return this.direction}makeSpriteSheet(){let t=document.createElement("canvas"),e=t.getContext("2d");return t.width=51,t.height=21,X(e,"2a173b95c5ac69809e4c5c873f2c5f","@@IIIIA@@@HIIII@@@@IIIIA@@HQRRRRI@@IRRRRJA@HQRRRRI@HRRRRRRJ@QRRRRRRAHRRRRRRJHRQJRJRQJQJRQRQJRIRQJRJRQJQJRKISJRIRQZIYRQJQJRKISJRIJKI[KIKJQYIY[IYQIJKI[KIKJQSaIJaQSIZJLQILZJQSaIJaQSIRJLQILRJQRaIJaQRIRJLQILRJQRaIJaQRIRJLQILRJQRaIJaQRISJLQILRKYRaIJaQZISJLQILRKHSKYZISK@YZISKYZAHSKYZISK@H[[YY[K@@Y[KK[[A@H[[YY[K@@HY[[[I@@@I[[[KA@@HY[[[I@@@IQQQIA@@@HJJJ@@@@@QQQA@@@HJIIIJ@@@@IHHA@@@@HAAI@@@@HKJJK@@@HA@@@I@@@@@@@@@@@@I[[KA@@@QAAAQA@@HA@@@I@@@@IIIA@@@@YQQYA@@@QAAAQA@@@@@@@@@@@HY[[I@@@@YQQYA@@@@@@@@@@@@HIII@@@@HY[[I@@@@@@@@@@@@@@@@@@@@@HIII@@@",51,21),x({x:0,y:0,anchor:{x:.5,y:.5},animations:k({image:t,frameWidth:17,frameHeight:21,animations:{walk:{frames:"0..2",frameRate:20}}}).animations})}draw(){this.testSprite.setScale(2),this.testSprite.render()}drawCollisionCircle(){let{context:t,radius:e}=this;t.fillStyle="#b3a378",t.beginPath(),t.arc(0,0,e,0,2*Math.PI),t.fill()}update(){this.travelMethod(),this.testSprite.update()}scaleUpdate(){let t=D({t:++this.counter,b:1,_c:2,d:60});this.setScale(t)}travelMethod(){if(void 0===this.direction||"number"!=typeof this.direction)return;let t=45*this.direction/180*Math.PI;this.x+=this.mov_speed*Math.cos(t),this.y+=this.mov_speed*Math.sin(t),this.scaleUpdate()}}var B=(t=>(t[t.LEFT=0]="LEFT",t[t.IDLE=1]="IDLE",t[t.RIGHT=2]="RIGHT",t))(B||{});class $ extends f{constructor(t){super({...t,type:"player",anchor:{x:0,y:0},radius:11}),e(this,"canvas",o()),e(this,"type","player"),e(this,"radius",11),e(this,"direction",2),e(this,"width",0),e(this,"height",0),e(this,"anim_state",1),e(this,"context",c()),e(this,"ang_period",1e3),e(this,"ang_interval",Math.PI/4),e(this,"ang_speed",this.ang_interval/this.ang_period),e(this,"counter",0),e(this,"CANVAS_CENTER"),e(this,"PATTERN_R",0),e(this,"LOCATION_R",0)}update(){this.canvas=o(),this.CANVAS_CENTER={x:this.canvas.width/2,y:this.canvas.height/2},this.PATTERN_R=.4*this.canvas.width,this.LOCATION_R=.1*this.canvas.width}draw(){switch(this.anim_state){case 1:V(this.context,U,"@@@@IIIA@@@@@@HQRRRI@@@@@HR[[[SJ@@@@HZ[[[[[J@@@@a[[[[[cA@@@HedddddM@@@@qmmmmmuA@@@H^[ts\\[N@@HIq[Z^^ZsIIHbL^k^[n[NdJamK^[[[[NkeAIiM^[[[NmIA@@INm[kMNA@@@@HNIIIN@@@@@@HvvvN@@@@@@@i[[kA@@@@@@HvvvN@@@@@@@imImA@@@@@@HmAIA@@@@@@@HIHM@@@@@@@@iAH@@@@@@@@@A@@@@@@",23,22),this.setScale(4,4),this.counter=0;break;case 0:V(this.context,U,G,21,22),this.setScale(4,4);break;case 2:V(this.context,U,G,21,22),this.setScale(-4,4)}this.launchMovement(this.anim_state)}get getDirection(){return this.direction}get getAnimState(){return this.anim_state}setLocation(t){this.rotation=-Math.PI/2+t,this.position.x=this.CANVAS_CENTER.x+Math.cos(t)*this.PATTERN_R,this.position.y=this.CANVAS_CENTER.x+Math.sin(t)*this.PATTERN_R}drawCollisionCircle(){let{context:t,radius:e}=this;t.fillStyle="rgba(255, 255, 0, 0.25)",t.beginPath(),t.arc(0,0,e,0,2*Math.PI),t.fill()}clearSprite(){let t=c(),e={w:this.width*this.scaleX,h:this.height*this.scaleY},i={x:this.x-e.w/2,y:this.y-e.h/2};t.clearRect(i.x,i.y,e.w,e.h)}setDirection(t){return t>7?0:0>t?7:t}launchMovement(t){let e=45*this.direction/180*Math.PI,i=0,s=0,h=0;if(0===t)i=e+Math.PI/4,h=D({t:++this.counter,b:e,_c:i,d:12}),s=p(e,i,h),i>s||(this.anim_state=1,this.direction=this.setDirection(this.direction+1));else{if(2!==t)return 1===t?void 0:void console.error("Player state error");i=e-Math.PI/4,h=D({t:++this.counter,b:e,_c:i,d:12}),s=p(i,e,h),s>i||(this.anim_state=1,this.direction=this.setDirection(this.direction-1))}this.setLocation(s)}moveInArc(t){this.anim_state=t?0:2}}var F=(t=>(t[t.EAST=0]="EAST",t[t.SOUTH_EAST=1]="SOUTH_EAST",t[t.SOUTH=2]="SOUTH",t[t.SOUTH_WEST=3]="SOUTH_WEST",t[t.WEST=4]="WEST",t[t.NORTH_WEST=5]="NORTH_WEST",t[t.NORTH=6]="NORTH",t[t.NORTH_EAST=7]="NORTH_EAST",t))(F||{});const z=new class{constructor(){e(this,"canvas",o()),e(this,"scoreText"),e(this,"timerText"),e(this,"score",0),e(this,"entities",[]),e(this,"location_coords",[]),e(this,"CANVAS_CENTER"),e(this,"PATTERN_R",0),e(this,"LOCATION_R",0),e(this,"hitCount",0),e(this,"globalCount",0),e(this,"counter",0),e(this,"switch",0),e(this,"threshold",[1200,600]),e(this,"currThres",this.threshold[0]),e(this,"isCoinSpawn",!0),e(this,"spawnThres",45),e(this,"rampPeriod",0),e(this,"defineInputEvent",(t=>{let e=this.entities.find((t=>"player"===t.type));e&&e.getAnimState===B.IDLE&&("ArrowLeft"===t.key?e.moveInArc(!0):"ArrowRight"===t.key&&e.moveInArc(!1))}))}onEnter(){let t=c();this.canvas=o(),this.CANVAS_CENTER={x:this.canvas.width/2,y:this.canvas.height/2},this.PATTERN_R=.4*this.canvas.width,this.LOCATION_R=.1*this.canvas.width,this.resetParams(),this.createScoreText(),this.createTime(),this.determineLocationCoords(),this.drawLocations(t),this.createPlayer(F.SOUTH),this.initPlayerInput()}resetParams(){this.hitCount=0,this.counter=0,this.globalCount=0,this.switch=0,this.isCoinSpawn=!0,this.currThres=this.threshold[0],this.spawnThres=45,this.rampPeriod=3600}onUpdate(){this.checkGameOver(),this.updateGlobalCount(),this.launchDifficultyRamp(),this.spawn(),this.checkCollision(),this.entities.map((t=>t.update())),this.entities=this.entities.filter((t=>t.isAlive()))}onRender(){this.entities.map((t=>t.render())),this.renderUI()}checkGameOver(){this.hitCount>2&&this.onGameOver()}spawn(){this.counter+=1,this.switch+=1;let t=this.getPlayer()?.getDirection;if(void 0!==t&&(this.currThres=this.threshold[this.isCoinSpawn?0:1],this.switch>this.currThres&&(this.isCoinSpawn=!this.isCoinSpawn,this.switch=0),this.counter>45)){if(this.isCoinSpawn){let e=u(t-2,t+2);this.createCoin(e)}else{let t=u(0,7);for(let e=0;3>e;e++){let i=e+1+t;i>7&&(i-=8),this.createEnemy(i)}}this.counter=0}}launchDifficultyRamp(){this.counter>this.rampPeriod&&(this.spawnThres*=.9,this.rampPeriod+=10800)}updateGlobalCount(){this.globalCount+=1}checkCollision(){this.entities.map(((t,e,i)=>{this.checkOutOfBounds(t)&&(i.splice(e,1),t.ttl=0),t.type&&"player"===t.type&&"player"===t.type&&this.entities.map(((e,i,s)=>{switch(e.type){case"enemy":W(t,e)&&(s.splice(i,1),e.ttl=0,this.onEnemyCollision());break;case"coin":W(t,e)&&(s.splice(i,1),e.ttl=0,this.onCoinCollision());break;default:return}}))}))}onEnemyCollision(){this.changeScore(-60),this.hitCount+=1}onCoinCollision(){this.changeScore(50)}renderUI(){let{scoreText:t,score:e,timerText:i}=this;t.text=`${e}`,t.render();let s=10>this.getSeconds(this.globalCount)?`0${this.getSeconds(this.globalCount)}`:`${this.getSeconds(this.globalCount)}`;i.text=`${this.getMinutes(this.globalCount)}:`+s,i.render()}getMinutes(t){return Math.floor(t/3600)}getSeconds(t){return Math.floor(t/60)}initPlayerInput(){window.addEventListener("keydown",this.defineInputEvent)}getPlayer(){let t=this.entities.find((t=>"player"===t.type));if(t)return t}createScoreText(){this.scoreText=g({text:`${this.score}`,font:"77px Arial",color:"white",x:100,y:50,anchor:{x:.5,y:.5}})}createTime(){this.timerText=g({text:"0:00",font:"77px Arial",color:"white",x:this.canvas.width-100,y:50,anchor:{x:.5,y:.5}})}determineLocationCoords(){for(let t=0;8>t;t++){let e=45*t/180*Math.PI,i={x:this.CANVAS_CENTER.x+Math.cos(e)*this.PATTERN_R,y:this.CANVAS_CENTER.y+Math.sin(e)*this.PATTERN_R};this.location_coords.push(i)}}createPlayer(t){let e=new $({x:this.location_coords[t].x,y:this.location_coords[t].y,direction:t});e.x=this.location_coords[t].x,e.y=this.location_coords[t].y,e.direction=t,this.entities.push(e)}createEnemy(t){let e=45*t/180*Math.PI,i=new j({x:this.CANVAS_CENTER.x+30*Math.cos(e),y:this.CANVAS_CENTER.y+30*Math.sin(e)});i.setDirection=t,this.entities.push(i)}createCoin(t){let e=45*t/180*Math.PI,i=new q({x:this.CANVAS_CENTER.x+30*Math.cos(e),y:this.CANVAS_CENTER.y+30*Math.sin(e)});i.setDirection=t,this.entities.push(i)}checkOutOfBounds(t){return t.x>this.canvas.width-t.radius||t.y>this.canvas.height-t.radius||t.x<-t.radius||t.y<-t.radius}drawLocations(t){for(let e=0;e<this.location_coords.length;e++){let i=x({x:this.location_coords[e].x,y:this.location_coords[e].y,color:"white",type:"location",render(){t.fillStyle=this.color?this.color:"",t.beginPath(),t.arc(0,0,15,0,2*Math.PI),t.fill()}});this.entities.push(i)}}setPlayerLocation(t){let e=this.entities.find((t=>"player"===t.type));e&&(e.x=this.location_coords[t].x,e.y=this.location_coords[t].y,e.direction=t)}changeScore(t){this.score=p(0,99999,this.score+t)}onGameOver(){window.removeEventListener("keydown",this.defineInputEvent),this.despawnEntities(),R.setState(tt,!0)}despawnEntities(){for(let t of this.entities)t.ttl=0;this.entities=[]}},tt=new class{constructor(){e(this,"isGameOver",!1),e(this,"titleText"),e(this,"mainText"),e(this,"instruct"),e(this,"instructB")}onEnter(t){this.isGameOver=t,this.drawMenu(),((t,e,{gamepad:i,key:s}={})=>{[].concat(t).map((t=>{if(K(t,v))((t,e,{gamepad:i,handler:s="gamepaddown"}={})=>{let h="gamepaddown"==s?S:H;[].concat(t).map((t=>{isNaN(i)?h[t]=e:(h[i]=h[i]||{},h[i][t]=e)}))})(t,e,i);else if(L(t));else if(K(t,J))((t,e,{handler:i="keydown",preventDefault:s=!0}={})=>{let h="keydown"==i?E:C;e._pd=s,[].concat(t).map((t=>h[t]=e))})(t,e,s);else{if(!["down","up"].includes(t))throw new TypeError(`"${t}" is not a valid input name`);(h=t)[0].toUpperCase(),h.substr(1)}var h}))})(["enter","space"],this.handleInput)}onUpdate(){}onRender(){!0===this.getGameOver?(this.titleText.text="Game Over ?",this.mainText.text="Press Enter to re-play"):!1===this.getGameOver&&(this.titleText.text="Echo of Depths / Death",this.mainText.text="Press Enter to play"),this.titleText.render(),this.mainText.render(),this.instruct.render(),this.instructB.render()}get getGameOver(){return this.isGameOver}set setGameOver(t){this.isGameOver=t}drawMenu(){let t=o();this.titleText=g({text:"a",font:"44px Arial",color:"white",x:t.width/2,y:t.height/2-76,anchor:{x:.5,y:.5}}),this.mainText=g({text:"b",font:"30px Arial",color:"white",x:t.width/2,y:t.height/2+0,anchor:{x:.5,y:.5}}),this.instruct=g({text:"<- to turn clock, -> to turn anti-clock",font:"30px Arial",color:"white",x:t.width/2,y:t.height/2+100,anchor:{x:.5,y:.5}}),this.instructB=g({text:"Get more points!!",font:"30px Arial",color:"white",x:t.width/2,y:t.height/2+150,anchor:{x:.5,y:.5}})}handleInput(){R.setState(z),((t,{gamepad:e,key:i}={})=>{[].concat(t).map((t=>{var s;K(t,v)?((t,{gamepad:e,handler:i="gamepaddown"}={})=>{let s="gamepaddown"==i?S:H;[].concat(t).map((t=>{isNaN(e)?delete s[t]:(s[e]=s[e]||{},delete s[e][t])}))})(t,e):L(t)||(K(t,J)?((t,{handler:e="keydown"}={})=>{let i="keydown"==e?E:C;[].concat(t).map((t=>delete i[t]))})(t,i):["down","up"].includes(t)&&((s=t)[0].toUpperCase(),s.substr(1)))}))})(["enter","space"])}};!function(){(()=>{let t;for(t=0;26>t;t++)J["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;10>t;t++)J["Digit"+t]=J["Numpad"+t]=""+t;window.addEventListener("keydown",N),window.addEventListener("keyup",Y),window.addEventListener("blur",b)})();let{canvas:t,context:e}=((t,{contextless:e=!1}={})=>{if(i=document.getElementById(t)||t||document.querySelector("canvas"),e&&(i=i||new Proxy({},a)),!i)throw Error("You must provide a canvas element for the game");return s=i.getContext("2d")||new Proxy({},a),s.imageSmoothingEnabled=!1,n("init"),{canvas:i,context:s}})();t.width=640,t.height=640,R=new Z(tt),R.setState(tt,!1);const r=function({fps:t=60,clearCanvas:e=!0,update:i=h,render:s,context:r=c(),blur:a=!1}={}){if(!s)throw Error("You must provide a render() function");let o,d,l,u,p,m=0,w=1e3/t,_=1/t,f=e?I:h,x=!0;function y(){if(d=requestAnimationFrame(y),x&&(l=performance.now(),u=l-o,o=l,1e3>=u)){for(n("tick"),m+=u;m>=w;)p.update(_),m-=w;f(r),p.render()}}return a||(window.addEventListener("focus",(()=>{x=!0})),window.addEventListener("blur",(()=>{x=!1}))),p={update:i,render:s,isStopped:!0,start(){o=performance.now(),this.isStopped=!1,requestAnimationFrame(y)},stop(){this.isStopped=!0,cancelAnimationFrame(d)},_frame:y,set _last(t){o=t}},p}({update(){R.getState().onUpdate()},render(){R.getState().onRender()}});r.start()}();
